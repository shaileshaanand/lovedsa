import React, { useState, useEffect } from "react";
import Navbar from "../components/Navbar";
import StatCard from "../components/StatCard";
import { useStats } from "../hooks/useStats";
import { babbar } from "../data/babbar";

function Stats() {
  const [problems, setproblems] = useState([]);
  const username = localStorage.getItem("gfg_username");
  const { data, isLoading, error, refetch, isFetching } = useStats(username, {
    enabled: true,
    refetchInterval: 10000,
  });

  const babbar_links = babbar.map((prob) => {
    return prob.l;
  });

  const done_links = data?.info
    ? [
        ...data.solvedStats.school.questions,
        ...data.solvedStats.basic.questions,
        ...data.solvedStats.easy.questions,
        ...data.solvedStats.medium.questions,
        ...data.solvedStats.hard.questions,
      ].map((q) => {
        return q.link;
      })
    : [];

  useEffect(() => {
    setproblems(
      babbar.map((prob) => {
        return {
          link: prob.l,
          title: prob.q,
          done: done_links.includes(prob.l),
        };
      })
    );
  }, [data]);

  return (
    <div className="font-primary">
      <Navbar />
      <div className="text-xl pt-3 px-3">
        Hi, {data?.info?.name || username}
      </div>
      <StatCard
        title="Your Goal"
        refetch={refetch}
        isFetching={isFetching}
        icon={
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            onClick={refetch}
          >
            <g clipPath="url(#clip0_6_78)">
              <path
                d="M3.37501 0.0718994C3.28126 0.1219 3.21563 0.187525 3.16563 0.281275C3.1 0.40315 3.09376 0.456275 3.09376 0.881275C3.09376 1.20315 3.10626 1.37815 3.13751 1.4469C3.19375 1.5844 3.35313 1.71253 3.51875 1.75628C3.65313 1.79378 3.65626 1.7969 3.65626 1.92815V2.06252H2.61563C1.42188 2.06252 1.33751 2.07503 1.10938 2.2844C0.89063 2.4844 0.85938 2.6094 0.862505 3.21878C0.868755 4.25003 1.09376 5.21878 1.53751 6.1094C2.21876 7.46878 3.34376 8.41565 4.88438 8.9219C5.20938 9.02815 5.37188 9.10003 5.54063 9.21565C5.82501 9.4094 6.16876 9.59378 6.45625 9.70315C6.65938 9.78128 6.68438 9.80003 6.77188 9.95315C7.06876 10.4688 7.18125 11.0625 7.09063 11.625C7.07501 11.7375 7.00626 11.9813 6.94376 12.1719L6.82813 12.5157L6.40626 12.5313C6.01563 12.5469 5.97188 12.5532 5.81876 12.6407C5.63126 12.7438 5.47188 12.9063 5.36875 13.1C5.30938 13.2157 5.29688 13.2938 5.28751 13.6313L5.275 14.0313H4.78438C4.35626 14.0313 4.28438 14.0375 4.19688 14.0938C3.99376 14.2157 3.98438 14.2532 3.98438 15C3.98438 15.6188 3.99063 15.6813 4.04688 15.7813C4.18438 16.0157 3.89688 16 8 16C12.1031 16 11.8156 16.0157 11.9531 15.7813C12.0094 15.6813 12.0156 15.6188 12.0156 15C12.0156 14.3469 12.0125 14.325 11.9438 14.225C11.8188 14.05 11.7438 14.0313 11.2094 14.0313H10.725L10.7125 13.6313C10.7031 13.2938 10.6906 13.2157 10.6313 13.1C10.5281 12.9063 10.3688 12.7438 10.1813 12.6407C10.0281 12.5532 9.98438 12.5469 9.59375 12.5313L9.17188 12.5157L9.05625 12.1719C8.99375 11.9813 8.925 11.7375 8.90938 11.625C8.81875 11.0625 8.925 10.4844 9.2125 9.97815C9.31563 9.7969 9.33438 9.7844 9.54375 9.70315C9.83125 9.59378 10.2469 9.3719 10.4875 9.20003C10.6313 9.0969 10.7875 9.02815 11.1125 8.9219C12.1344 8.59378 13.0281 8.0219 13.6594 7.30315C14.6063 6.21878 15.1281 4.77503 15.1375 3.21878C15.1406 2.6094 15.1094 2.4844 14.8906 2.2844C14.6625 2.07503 14.5781 2.06252 13.3844 2.06252H12.3438V1.92815C12.3438 1.7969 12.3469 1.79378 12.4813 1.75628C12.6469 1.71253 12.8063 1.5844 12.8625 1.4469C12.8938 1.37815 12.9063 1.20315 12.9063 0.881275C12.9063 0.456275 12.9 0.40315 12.8344 0.281275C12.7844 0.187525 12.7188 0.1219 12.625 0.0718994L12.4906 2.47955e-05H9.43125C7.53125 2.47955e-05 6.35001 0.0125246 6.31563 0.0312748C6.28438 0.0468998 6.24063 0.100025 6.22188 0.15315C6.19063 0.228149 6.19063 0.259399 6.23126 0.34065C6.25938 0.393775 6.28751 0.44065 6.29063 0.443775C6.29376 0.450025 7.675 0.4594 9.35938 0.468775L12.4219 0.4844V0.89065V1.2969H8H3.57813V0.89065V0.4844L4.50313 0.468775C5.35938 0.45315 5.43751 0.450025 5.49688 0.393775C5.59376 0.306275 5.58438 0.1469 5.48126 0.06565C5.4 0.00314999 5.3625 2.47955e-05 4.45313 2.47955e-05C3.52813 2.47955e-05 3.50625 2.47955e-05 3.37501 0.0718994ZM11.875 3.83128C11.875 6.09378 11.8625 6.2719 11.6844 6.8219C11.125 8.54378 9.44063 9.66565 7.67188 9.50003C6.74688 9.41253 5.97501 9.05628 5.31251 8.41878C4.74688 7.8719 4.40626 7.25628 4.19688 6.40628C4.15313 6.23128 4.14376 5.88128 4.13438 3.99065L4.12188 1.78127H7.99688H11.875V3.83128ZM3.65626 2.84065V3.15315L2.96251 3.16253C2.29063 3.1719 2.26251 3.17503 2.16251 3.24378C1.99688 3.36253 1.95626 3.47503 1.98126 3.75628C2.03126 4.3469 2.23751 5.06878 2.51563 5.62503C2.79376 6.1844 3.27813 6.7719 3.75938 7.1344C3.94375 7.27503 3.99063 7.33128 4.10001 7.5469C4.16876 7.6844 4.29063 7.89378 4.37188 8.01565C4.45001 8.1344 4.52813 8.25315 4.54063 8.2719C4.57188 8.3219 4.2125 8.1594 3.94375 8.00315C2.63126 7.23753 1.77188 6.00315 1.45313 4.43128C1.32501 3.7844 1.27188 2.96878 1.34688 2.75315C1.36876 2.6969 1.42813 2.62503 1.48126 2.59065C1.57188 2.5344 1.65001 2.53127 2.61876 2.53127H3.65626V2.84065ZM14.5031 2.58127C14.6875 2.67502 14.725 2.95315 14.6563 3.70315C14.4781 5.59378 13.6 7.06565 12.1094 7.9719C11.8438 8.13128 11.425 8.32815 11.4594 8.2719C11.4719 8.25315 11.55 8.1344 11.6281 8.01565C11.7094 7.89378 11.8313 7.6844 11.9 7.5469C12.0094 7.33128 12.0563 7.27503 12.2438 7.13128C12.7125 6.77815 13.2188 6.16878 13.4719 5.65003C13.5906 5.40628 13.5781 5.2969 13.425 5.2219C13.2688 5.1469 13.1969 5.20315 13.0063 5.53128C12.8125 5.8719 12.5625 6.2094 12.375 6.39065C12.2813 6.48128 12.2469 6.4969 12.2594 6.45315C12.3188 6.25315 12.3438 5.73128 12.3438 4.74378V3.62503H12.9531C13.4563 3.62503 13.5625 3.63128 13.5625 3.66878C13.5625 3.69378 13.5344 3.87815 13.5 4.07815C13.4344 4.46253 13.4438 4.52815 13.5625 4.59378C13.6594 4.64378 13.7656 4.63128 13.8344 4.55315C13.9094 4.47503 13.9875 4.13128 14.0188 3.75628C14.0438 3.47503 14.0031 3.36253 13.8375 3.24378C13.7375 3.17503 13.7094 3.1719 13.0406 3.16253L12.3438 3.15315V2.84065V2.53127H13.375C14.2531 2.53127 14.425 2.53753 14.5031 2.58127ZM3.65626 4.74065C3.65626 5.74065 3.68125 6.2469 3.73438 6.45003C3.76251 6.55003 3.38125 6.13753 3.20625 5.87503C2.86876 5.3719 2.61563 4.7344 2.50001 4.08753C2.46563 3.8969 2.43751 3.71253 2.43751 3.68128C2.43751 3.62815 2.47813 3.62503 3.04688 3.62503H3.65626V4.74065ZM7.84375 9.9844C7.92188 9.99378 8.13751 9.9844 8.32501 9.96878C8.51563 9.95315 8.67188 9.94378 8.67813 9.95003C8.68438 9.95628 8.65938 10.0282 8.625 10.1094C8.3625 10.725 8.34375 11.5313 8.57813 12.2219C8.61875 12.3469 8.65625 12.4719 8.65625 12.4907C8.65625 12.5219 8.50313 12.5313 8 12.5313C7.49688 12.5313 7.34375 12.5219 7.34375 12.4907C7.34375 12.4719 7.37813 12.35 7.42188 12.2219C7.67188 11.4844 7.64063 10.725 7.32813 9.99065C7.30313 9.93128 7.30313 9.93128 7.84375 9.9844ZM9.95938 13.05C10.0188 13.0782 10.1031 13.1532 10.15 13.2125C10.2281 13.3157 10.2344 13.35 10.2438 13.6782L10.2563 14.0313H8H5.74375L5.75626 13.6782C5.76563 13.35 5.77188 13.3157 5.85001 13.2125C6.01875 12.9938 5.93438 13 7.99375 13C9.65 13 9.8625 13.0063 9.95938 13.05ZM11.5625 15.0157V15.5313H8H4.43751V15.0157V14.5H8H11.5625V15.0157Z"
                fill="black"
              />
              <path
                d="M7.73123 3.5594C7.5906 3.64377 7.51248 3.75627 7.34373 4.11252C7.24998 4.31252 7.17185 4.43752 7.13748 4.4469C7.1031 4.45627 6.9156 4.48752 6.71873 4.51565C6.3406 4.5719 6.24373 4.60627 6.13748 4.72502C6.0281 4.84377 5.9906 4.94065 5.9906 5.11252C5.9906 5.3219 6.04998 5.41565 6.38748 5.7469C6.53435 5.89065 6.65623 6.03127 6.65623 6.05627C6.65623 6.0844 6.6281 6.26877 6.5906 6.46877C6.53748 6.76252 6.53123 6.85627 6.55935 6.9594C6.6031 7.12502 6.69685 7.23752 6.84685 7.31252C7.05623 7.4219 7.1906 7.3969 7.61873 7.18127L7.99998 6.9844L8.38435 7.18127C8.80935 7.3969 8.94373 7.4219 9.1531 7.31252C9.3031 7.23752 9.39685 7.12502 9.4406 6.9594C9.4656 6.8594 9.45935 6.7594 9.4031 6.4344L9.33123 6.03127L9.63123 5.72502C9.79373 5.5594 9.94685 5.38752 9.96873 5.34377C10.0187 5.2469 10.0219 4.9719 9.96873 4.87502C9.84998 4.64377 9.73435 4.58127 9.29685 4.51877C9.10623 4.49065 8.91873 4.4594 8.88123 4.45002C8.82185 4.43752 8.77185 4.36252 8.6531 4.11252C8.4906 3.76252 8.38435 3.61565 8.24685 3.5469C8.12185 3.48127 7.84998 3.48752 7.73123 3.5594ZM8.24685 4.34065C8.43123 4.70627 8.5531 4.85627 8.69685 4.89065C8.73435 4.90002 8.93123 4.9344 9.13748 4.96565C9.49373 5.0219 9.57498 5.05627 9.5406 5.14377C9.53435 5.16252 9.40935 5.29065 9.26248 5.4219C9.1156 5.55315 8.96873 5.71565 8.93748 5.7844C8.85935 5.93127 8.85935 6.05002 8.93435 6.4844C8.99373 6.84065 8.99373 6.90627 8.9156 6.90627C8.8906 6.90627 8.70935 6.8219 8.51248 6.71877C8.2156 6.56252 8.1281 6.53127 8.0031 6.53127C7.87498 6.53127 7.78435 6.56252 7.4906 6.71877C7.2906 6.8219 7.10935 6.90627 7.08435 6.90627C7.00623 6.90627 7.0031 6.82815 7.0656 6.48127C7.09685 6.2969 7.12498 6.08752 7.12498 6.01565C7.12498 5.84065 7.0031 5.65627 6.70935 5.39377C6.5781 5.27502 6.4656 5.16252 6.45935 5.14065C6.42498 5.05627 6.50623 5.0219 6.8781 4.96565C7.0906 4.93127 7.2906 4.8969 7.32185 4.88752C7.4531 4.8469 7.57498 4.69065 7.7531 4.34065C7.89685 4.05315 7.9531 3.96877 7.99998 3.96877C8.04685 3.96877 8.1031 4.05315 8.24685 4.34065Z"
                fill="black"
              />
            </g>
            <defs>
              <clipPath id="clip0_6_78">
                <rect width="16" height="16" fill="white" />
              </clipPath>
            </defs>
          </svg>
        }
        problems={problems}
      />
    </div>
  );
}

export default Stats;
